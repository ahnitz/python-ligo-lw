%global shortname ligo-lw

Name: 		python-%{shortname}
Summary:	LIGO Light-Weight XML I/O Library
Version:	@VERSION@
Release:	1%{?dist}
License:	GPL-3.0-or-later
Source:		http://software.ligo.org/lscsoft/source/%{name}-%{version}.tar.gz
Url:		https://git.ligo.org/kipp.cannon/python-ligo-lw
Prefix:		%{_prefix}

BuildRequires:	python-rpm-macros
BuildRequires:	python-srpm-macros
BuildRequires:	python2-rpm-macros
BuildRequires:	python3-rpm-macros
BuildRequires:	epel-rpm-macros

BuildRequires:	python-devel
BuildRequires:	python%{python3_pkgversion}-devel

%description
The LIGO Light-Weight XML format is widely used within gravitational-wave
data analysis pipelines.  This package provides Python libraries
to read, write, and interact with documents in this format, as well as
several programs to perform common, basic, manipulations of files in this format.

%package -n python2-%{shortname}
Summary:	LIGO Light-Weight XML I/O Library (python%{python2_version})
Requires:	glue
Requires:	python >= 2.7
Requires:	python-dateutil
Requires:	python-six
Requires:	python2-lal
# temporarily commented out to break cyclic dependency.  lalburst is an
# optional dependency, but the rpm version at CIT is too old for that
# feature
#Requires:	python2-lalburst
Requires:	python2-ligo-common
Requires:	python2-ligo-segments
Requires:	PyYAML
# temporary dependency to ensure -bin package is installed.  remove when
# other things, like gstlal, depend on -bin themselves
Requires:	%{name}-bin
%{?python_provide:%python_provide python2-%{shortname}}
%description -n python2-%{shortname}
The LIGO Light-Weight XML format is widely used within gravitational-wave
data analysis pipelines.  This package provides a Python library to read,
write, and interact with documents in this format.

%package -n python%{python3_pkgversion}-%{shortname}
Summary:	LIGO Light-Weight XML I/O Library (python%{python3_version})
Requires:	python%{python3_pkgversion}
Requires:	python%{python3_pkgversion}-dateutil
Requires:	python%{python3_pkgversion}-glue
Requires:	python%{python3_pkgversion}-lal
# temporarily commented out to break cyclic dependency.  lalburst is an
# optional dependency, but the rpm version at CIT is too old for that
# feature
#Requires:	python%{python3_pkgversion}-lalburst
Requires:	python%{python3_pkgversion}-ligo-common
Requires:	python%{python3_pkgversion}-ligo-segments
Requires:	python%{python3_pkgversion}-six
Requires:	python%{python3_pkgversion}-PyYAML
%{?python_provide:%python_provide python%{python3_pkgversion}-%{shortname}}
%description -n python%{python3_pkgversion}-%{shortname}
The LIGO Light-Weight XML format is widely used within gravitational-wave
data analysis pipelines.  This package provides a Python library to read,
write, and interact with documents in this format.

%package bin
Summary:	Programs for manipulating LIGO Light-Weight XML files
Requires:	%{name} = %{version}
Requires:	glue
Requires:	python >= 2.7
Requires:	python2-lal
Requires:	python2-ligo-segments
Conflicts:	glue-ligolw-tools
Obsoletes:	glue-ligolw-tools
Provides:	glue-ligolw-tools
Conflicts:	glue < 2.0 python-pylal
%description bin
The LIGO Light-Weight XML format is widely used within gravitational-wave
data analysis pipelines.  This package provides several programs to
performe common, basic, manipulations of files in this format.

%prep
%setup

%build
%py2_build
%py3_build

%install
# install python3 first so that /bin/ is populated by python2
%py3_install
%py2_install

%files -n python2-%{shortname}
%license LICENSE
%{python2_sitearch}

%files -n python%{python3_pkgversion}-%{shortname}
%license LICENSE
%{python3_sitearch}

%files bin
%license LICENSE
%{_bindir}/*

%changelog
*  Tue May 8 2018 Kipp Cannon <kipp.cannon@ligo.org>
- Initial release.
